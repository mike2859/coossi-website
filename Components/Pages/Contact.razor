@page "/contact"

@using System.ComponentModel.DataAnnotations
@using Coossi.Blazor.Components.Shared
@using Coossi.Blazor.Data.Models
@inject NavigationManager Nav

@code {
    // ----- Modèle du formulaire (tu peux déplacer la classe dans /Data/Models/ContactForm.cs)
    
    private ContactFormDto Model = new();
    private bool Sent = false;
    private bool Error = false;

    private async Task HandleSubmit()
    {
        // honeypot: si rempli, on ignore
        if (!string.IsNullOrWhiteSpace(Model.Company))
        {
            Sent = true;
            return;
        }

        try
        {
            // TODO: branchement réel — voir la section "Envoi" plus bas
            await Task.Delay(300); // simulate
            Sent = true;
            Error = false;
        }
        catch
        {
            Error = true;
            Sent = false;
        }
        StateHasChanged();
    }

    string Canonical => $"{Nav.BaseUri.TrimEnd('/')}/contact";
}

<!-- SEO -->
<Seo Title="Contact | COOSSI – Sécurité Incendie"
     Description="Parlez-nous de votre projet (coordination SSI, dossiers, notices, audit, DUERP, signalétique). Réponse rapide."
     Canonical="@Canonical"
     OgImage="images/og-prestations.webp" />

<!-- Header -->
<PageHeader Title="Contact"
            Lead="Dites-nous en plus sur votre besoin : nous vous répondons rapidement." />

<section class="content-section">
  <div class="container">

    @if (Sent && !Error)
    {
        <div class="info-card" role="status" aria-live="polite">
            <h3><i class="fas fa-check-circle"></i> Merci !</h3>
            <p>Votre message a bien été envoyé. Nous revenons vers vous au plus vite.</p>
            <a class="btn-primary-custom" href="/">Retour à l’accueil</a>
        </div>
    }
    else
    {
        <div class="row g-4">
            <!-- Formulaire -->
            <div class="col-lg-8">
                <div class="info-card">
                    <h3 class="mb-3"><i class="fas fa-envelope"></i> Nous écrire</h3>

                    @if (Error)
                    {
                        <div class="alert-warning-custom mb-3">
                            <strong>Oups…</strong> Une erreur est survenue pendant l’envoi. Merci de réessayer.
                        </div>
                    }

                    <EditForm Model="Model" OnValidSubmit="HandleSubmit">
                        <DataAnnotationsValidator />
                        <ValidationSummary />

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom *</label>
                                <InputText class="form-control" @bind-Value="Model.Name" />
                                <ValidationMessage For="() => Model.Name" />
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email *</label>
                                <InputText class="form-control" @bind-Value="Model.Email" />
                                <ValidationMessage For="() => Model.Email" />
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">Téléphone</label>
                                <InputText class="form-control" @bind-Value="Model.Phone" />
                                <ValidationMessage For="() => Model.Phone" />
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">Sujet *</label>
                                <InputText class="form-control" @bind-Value="Model.Subject" />
                                <ValidationMessage For="() => Model.Subject" />
                            </div>

                            <div class="col-12 mb-3">
                                <label class="form-label">Message *</label>
                                <InputTextArea class="form-control" rows="6" @bind-Value="Model.Message" />
                                <ValidationMessage For="() => Model.Message" />
                            </div>

                            <!-- honeypot (caché aux humains) -->
                            <div class="d-none">
                                <InputText class="form-control" @bind-Value="Model.Company" />
                            </div>

                            <div class="col-12 mb-3 form-check">
                                <InputCheckbox class="form-check-input" @bind-Value="Model.Consent" />
                                <label class="form-check-label">
                                    J’accepte que mes données soient utilisées pour me recontacter. Voir
                                    <a href="/confidentialite">Confidentialité</a>.
                                </label>
                            </div>

                            <div class="col-12">
                                <button type="submit" class="btn-primary-custom">
                                    <i class="fas fa-paper-plane"></i> Envoyer
                                </button>
                            </div>
                        </div>
                    </EditForm>
                </div>
            </div>

            <!-- Coordonnées / Infos -->
            <div class="col-lg-4">
                <div class="info-card">
                    <h4><i class="fas fa-phone"></i> Contact direct</h4>
                    <p class="mb-2"><strong>Tél :</strong> <a href="tel:0685752775">06 85 75 27 75</a></p>
                    <p class="mb-0"><strong>Email :</strong> <a href="mailto:contact@coossi-securite-incendie.eu">contact@coossi-securite-incendie.eu</a></p>
                    <hr />
                    <h5><i class="fas fa-map-marker-alt"></i> Adresse</h5>
                    <p class="mb-0">Villers Pol, Nord (59)</p>
                </div>

                <div class="info-card mt-4">
                    <h4 class="mb-2"><i class="fas fa-clock"></i> Disponibilité</h4>
                    <p class="mb-0">Lun → Sam • 9h – 19h</p>
                </div>
            </div>
        </div>
    }
  </div>
</section>

<CtaBar Title="Un projet sécurité incendie ?"
        Text="Coordination SSI, notices, plans, audit, DUERP… On vous répond rapidement."
        CtaText="Appeler"
        CtaHref="tel:0685752775"
        IconClass="fas fa-fire-extinguisher" />

@*         
<CtaBar Title="Un projet sécurité incendie ?"
        Text="Coordination SSI, notices, plans, audit, DUERP… On vous répond rapidement."
        CtaText="Appeler"
        CtaHref="tel:0685752775"
        IconClass="fas fa-fire-extinguisher" /> *@
