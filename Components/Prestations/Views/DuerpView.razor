@using Coossi.Blazor.Components.Shared
@using Coossi.Blazor.Data.Interfaces
@using Coossi.Blazor.Data.Models.Prestations
@inject IContentStore Store
@inject NavigationManager Nav

@code {
    [Parameter] public string Slug { get; set; } = "";
    private DuerpPage? Model;

    protected override async Task OnParametersSetAsync()
        => Model = await Store.GetAsync<DuerpPage>($"prestations/{Slug}");

    string Canonical => $"{Nav.BaseUri.TrimEnd('/')}/prestation/{Slug}";
}

@if (Model is null) { <section class="content-section"><div class="container text-muted">Chargement…</div></section> }
else {
  <Seo Title="@Model.Seo.MetaTitle" Description="@Model.Seo.MetaDescription" Canonical="@Canonical" OgImage="@(Model.Seo.OgImage ?? "images/og-prestations.webp")" />
  <PageHeader Title="@Model.Hero.Title" Lead="@Model.Hero.Subtitle" />

  <section class="content-section"><div class="container"><div class="info-card">
    <h2 class="section-title">Qu’est-ce que le DUERP ?</h2><p>@Model.IntroText</p>
  </div></div></section>

  <section class="content-section"><div class="container">
    <h2 class="section-title">@Model.ObjectifTitle</h2>
    <div class="row mt-3">
      @foreach (var it in Model.ContenuItems)
      {
        <div class="col-lg-6 mb-4"><div class="info-card h-100"><h3>@it</h3></div></div>
      }
    </div>
  </div></section>

  <section class="content-section"><div class="container">
    <h2 class="section-title">Types de risques évalués</h2>
    <div class="row">
      @foreach (var r in Model.Risques)
      {
        <div class="col-lg-4 mb-4"><div class="info-card h-100 text-center">
          <i class="fas fa-exclamation-circle fa-3x mb-3" style="color:var(--primary-color);"></i><h3>@r</h3>
        </div></div>
      }
    </div>
  </div></section>

  <section class="content-section"><div class="container"><div class="info-card">
    <h2 class="section-title">Mise à jour du DUERP</h2>
    <ul>@foreach (var m in Model.MiseAJour) { <li>@m</li> }</ul>
  </div></div></section>

  <section class="content-section"><div class="container">
    <h2 class="section-title">Formats disponibles</h2>
    <div class="row">
      @foreach (var f in Model.Formats)
      {
        <div class="col-lg-6 mb-4"><div class="info-card text-center h-100">
          <i class="fas fa-file-alt fa-3x mb-3" style="color:var(--primary-color);"></i><h3>@f</h3>
        </div></div>
      }
    </div>
  </div></section>

  <section class="content-section"><div class="container"><div class="info-card text-center">
    <h3>Contact</h3>@((MarkupString)Model.ContactHtml)
    <a class="btn-primary-custom mt-3" href="/contact"><i class="fas fa-envelope"></i> Nous contacter</a>
  </div></div></section>

  <section class="content-section"><div class="container">
    <h2 class="section-title">Nos zones d’intervention</h2>
    <div class="city-links">@foreach (var c in Model.Cities) { <a>@c</a> }</div>
  </div></section>

  
  
  <CtaBar Title="@Model.Cta.Title" Text="@Model.Cta.Text" />
  /*
  <CtaBar Title="@Model.Cta.Title" Text="@Model.Cta.Text"
          CtaText="@Model.Cta.ButtonText" CtaHref="@Model.Cta.ButtonHref"
          IconClass="fas fa-comments" />*/
}
